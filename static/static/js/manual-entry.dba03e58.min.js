const INITIAL_BRACKET_INFO={description:null,wrestlerChoices:[{id:0,name:"Wrestler 1",team:"Team 1"},{id:1,name:"Wrestler 2",team:"Team 2"},{id:2,name:"Wrestler 3",team:"Team 3"},{id:3,name:"Wrestler 4",team:"Team 4"},{id:4,name:"Wrestler 5",team:"Team 5"},{id:5,name:"Wrestler 6",team:"Team 6"},{id:6,name:"Wrestler 7",team:"Team 7"},{id:7,name:"Wrestler 8",team:"Team 8"},{id:8,name:"Wrestler 9",team:"Team 9"},{id:9,name:"Wrestler 10",team:"Team 10"},{id:10,name:"Wrestler 11",team:"Team 11"},{id:11,name:"Wrestler 12",team:"Team 12"},{id:12,name:"Wrestler 13",team:"Team 13"},{id:13,name:"Wrestler 14",team:"Team 14"},{id:14,name:"Wrestler 15",team:"Team 15"},{id:15,name:"Wrestler 16",team:"Team 16"},{id:16,name:"Wrestler 17",team:"Team 17"},{id:17,name:"Wrestler 18",team:"Team 18"},{id:18,name:"Wrestler 19",team:"Team 19"},{id:19,name:"Wrestler 20",team:"Team 20"},{id:20,name:"Wrestler 21",team:"Team 21"},{id:21,name:"Wrestler 22",team:"Team 22"},{id:22,name:"Wrestler 23",team:"Team 23"},{id:23,name:"Wrestler 24",team:"Team 24"}],matches:{1:{top:{choice:0,choices:[0]},bottom:{choice:null,choices:[]},winner:"top",boutNumber:null,result:"Bye"},2:{top:{choice:1,choices:[1]},bottom:{choice:2,choices:[2]},winner:null,boutNumber:null,result:""},3:{top:{choice:3,choices:[3]},bottom:{choice:null,choices:[]},winner:"top",boutNumber:null,result:"Bye"},4:{top:{choice:4,choices:[4]},bottom:{choice:5,choices:[5]},winner:null,boutNumber:null,result:""},5:{top:{choice:6,choices:[6]},bottom:{choice:null,choices:[]},winner:"top",boutNumber:null,result:"Bye"},6:{top:{choice:7,choices:[7]},bottom:{choice:8,choices:[8]},winner:null,boutNumber:null,result:""},7:{top:{choice:9,choices:[9]},bottom:{choice:null,choices:[]},winner:"top",boutNumber:null,result:"Bye"},8:{top:{choice:10,choices:[10]},bottom:{choice:11,choices:[11]},winner:null,boutNumber:null,result:""},9:{top:{choice:12,choices:[12]},bottom:{choice:null,choices:[]},winner:"top",boutNumber:null,result:"Bye"},10:{top:{choice:13,choices:[13]},bottom:{choice:14,choices:[14]},winner:null,boutNumber:null,result:""},11:{top:{choice:15,choices:[15]},bottom:{choice:null,choices:[]},winner:"top",boutNumber:null,result:"Bye"},12:{top:{choice:16,choices:[16]},bottom:{choice:17,choices:[17]},winner:null,boutNumber:null,result:""},13:{top:{choice:18,choices:[18]},bottom:{choice:null,choices:[]},winner:"top",boutNumber:null,result:"Bye"},14:{top:{choice:19,choices:[19]},bottom:{choice:20,choices:[20]},winner:null,boutNumber:null,result:""},15:{top:{choice:21,choices:[21]},bottom:{choice:null,choices:[]},winner:"top",boutNumber:null,result:"Bye"},16:{top:{choice:22,choices:[22]},bottom:{choice:23,choices:[23]},winner:null,boutNumber:null,result:""},17:{top:{choice:0,choices:[0]},bottom:{choice:null,choices:[1,2]},winner:null,boutNumber:null,result:""},18:{top:{choice:3,choices:[3]},bottom:{choice:null,choices:[4,5]},winner:null,boutNumber:null,result:""},19:{top:{choice:6,choices:[6]},bottom:{choice:null,choices:[7,8]},winner:null,boutNumber:null,result:""},20:{top:{choice:9,choices:[9]},bottom:{choice:null,choices:[10,11]},winner:null,boutNumber:null,result:""},21:{top:{choice:12,choices:[12]},bottom:{choice:null,choices:[13,14]},winner:null,boutNumber:null,result:""},22:{top:{choice:15,choices:[15]},bottom:{choice:null,choices:[16,17]},winner:null,boutNumber:null,result:""},23:{top:{choice:18,choices:[18]},bottom:{choice:null,choices:[19,20]},winner:null,boutNumber:null,result:""},24:{top:{choice:21,choices:[21]},bottom:{choice:null,choices:[22,23]},winner:null,boutNumber:null,result:""},33:{top:{choice:null,choices:[0]},bottom:{choice:null,choices:[3]},winner:null,boutNumber:null,result:""},34:{top:{choice:null,choices:[6]},bottom:{choice:null,choices:[9]},winner:null,boutNumber:null,result:""},35:{top:{choice:null,choices:[12]},bottom:{choice:null,choices:[15]},winner:null,boutNumber:null,result:""},36:{top:{choice:null,choices:[18]},bottom:{choice:null,choices:[21]},winner:null,boutNumber:null,result:""},37:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},38:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},39:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},40:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},41:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},42:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},43:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},44:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},45:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},46:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},47:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},48:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},49:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},50:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},52:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},53:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},54:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},1001:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},1003:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""},1005:{top:{choice:null,choices:[]},bottom:{choice:null,choices:[]},winner:null,boutNumber:null,result:""}}},EDIT_MATCH_INFO_CURRENT={matchID:1},STORAGE_KEY="manualEntrySerialized.3cd4823b",PREVIOUS_MATCH_MAP=Object.freeze({17:{bottom:2},18:{bottom:4},19:{bottom:6},20:{bottom:8},21:{bottom:10},22:{bottom:12},23:{bottom:14},24:{bottom:16},33:{top:17,bottom:18},34:{top:19,bottom:20},35:{top:21,bottom:22},36:{top:23,bottom:24},41:{bottom:37},42:{top:38},43:{bottom:39},44:{top:40},45:{top:33,bottom:34},46:{top:35,bottom:36},47:{top:41,bottom:42},48:{top:43,bottom:44},49:{bottom:47},50:{top:48},53:{top:49,bottom:50},54:{top:45,bottom:46},1001:{top:54},1003:{top:53},1005:{top:52}}),WIN_MATCH_MAP=Object.freeze({17:{match:33,position:"top"},18:{match:33,position:"bottom"},19:{match:34,position:"top"},20:{match:34,position:"bottom"},21:{match:35,position:"top"},22:{match:35,position:"bottom"},23:{match:36,position:"top"},24:{match:36,position:"bottom"},33:{match:45,position:"top"},34:{match:45,position:"bottom"},35:{match:46,position:"top"},36:{match:46,position:"bottom"},37:{match:41,position:"bottom"},38:{match:42,position:"top"},39:{match:43,position:"bottom"},40:{match:44,position:"top"},41:{match:47,position:"top"},42:{match:47,position:"bottom"},43:{match:48,position:"top"},44:{match:48,position:"bottom"},45:{match:54,position:"top"},46:{match:54,position:"bottom"},47:{match:49,position:"bottom"},48:{match:50,position:"top"},49:{match:53,position:"top"},50:{match:53,position:"bottom"},52:{match:1005,position:"top"},53:{match:1003,position:"top"},54:{match:1001,position:"top"},1001:null,1003:null,1005:null}),LOSE_MATCH_MAP=Object.freeze({1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,13:null,14:null,15:null,16:null,17:null,18:null,19:null,20:null,21:null,22:null,23:null,24:null,33:{match:41,position:"top"},34:{match:42,position:"bottom"},35:{match:43,position:"top"},36:{match:44,position:"bottom"},37:null,38:null,39:null,40:null,41:null,42:null,43:null,44:null,45:{match:49,position:"top"},46:{match:50,position:"bottom"},47:null,48:null,49:{match:52,position:"top"},50:{match:52,position:"bottom"},52:null,53:null,54:null}),DISABLE_BY_EXTRA=Object.freeze({45:{top:[37,41],bottom:[38,42]},46:{top:[39,43],bottom:[40,44]},53:{top:[52],bottom:[52]},54:{top:[49],bottom:[50]}}),RELATED_MATCH_IDS=Object.freeze([[17,24],[33,36],[37,40],[41,44],[45,46],[47,48],[49,50]]),LISTENER_REGISTERED={openMatchOverlay:!1},OVERLAY_NEXT_MATCH=Object.freeze({2:4,4:6,6:8,8:10,10:12,12:14,14:16,16:17,17:18,18:19,19:20,20:21,21:22,22:23,23:24,24:33,33:34,34:35,35:36,36:45,45:46,46:54,54:37,37:38,38:39,39:40,40:41,41:42,42:43,43:44,44:47,47:48,48:49,49:50,50:53,53:52});function numericalSort(e,t){return e-t}function uniqueNumerical(e){const t=[...new Set(e)].sort(numericalSort);return t}function validateParticipantID(e){if(e===null)return;if(!Number.isInteger(e)||e<0||e>23)throw new Error(`Invalid participant ID: ${e}`)}function writeToStorage(e){localStorage.setItem(STORAGE_KEY,JSON.stringify(e))}function loadFromStorage(e){const n=localStorage.getItem(STORAGE_KEY);if(n===null)return;const t=JSON.parse(n);e.description=t.description,e.wrestlerChoices=t.wrestlerChoices,e.matches=t.matches}function renderWrestlerInput(e,t){const n=e.wrestlerChoices[t],s=document.querySelector(`input.input-name[data-participant-id="${t}"]`);s.value=n.name;const o=document.querySelector(`input.input-team[data-participant-id="${t}"]`);o.value=n.team}function populateNameDiv(e,t,n,s){const o=t.querySelector("div.name"),i=t.querySelector("div.result");if(s===null?(t.className="participant",i.textContent=""):s===e?(t.className="participant win",i.textContent="W"):(t.className="participant loss",i.textContent="L"),o.textContent="",n===null){o.className="name bye",o.innerHTML="&nbsp;";return}const r=document.createTextNode(n.name),a=document.createElement("span");a.textContent=` (${n.team})`,o.appendChild(r),o.appendChild(a)}function renderMatchReadOnly(e,t,n){const s=e.matches[t],i=s.top.choice,a=s.bottom.choice,r=i===null?null:e.wrestlerChoices[i],c=a===null?null:e.wrestlerChoices[a],l=document.querySelector(`div.match[data-match-id="${t}"]`),o=l.querySelectorAll("div.participant");if(o.length!==2)throw new Error("Invalid DOM (participants)");n.includes("top")&&populateNameDiv("top",o[0],r,s.winner),n.includes("bottom")&&populateNameDiv("bottom",o[1],c,s.winner)}function matchIsDecided(e,t){const n=e.matches[t];return n.top.choice!==null&&n.bottom.choice!==null&&n.winner!==null}function populateParticipantSelect(e,t,n,s,o,i,a){const r=n.querySelector("select.participant-select"),c=n.querySelector("div.result");i===null?(n.className="participant",c.textContent=""):i===t?(n.className="participant win",c.textContent="W"):(n.className="participant loss",c.textContent="L"),r.innerHTML="";const l=document.createElement("option");l.value="",l.textContent="Select wrestler",r.appendChild(l);for(const n of o){const s=e.wrestlerChoices[n],t=document.createElement("option");t.value=`${n}`,t.textContent=s.name,r.appendChild(t)}if(s===null)r.value="";else{if(!o.includes(s))throw new Error("Choice is invalid");r.value=s}r.disabled=o.length<2||i!==null;const d=DISABLE_BY_EXTRA[a];if(d===0[0])return;for(const n of d[t])if(matchIsDecided(e,n)){r.disabled=!0;return}}function renderMatchSelect(e,t,n){const s=e.matches[t],i=s.top.choice,a=s.top.choices,r=s.bottom.choice,c=s.bottom.choices,l=document.querySelector(`div.match[data-match-id="${t}"]`),o=l.querySelectorAll("div.participant");if(o.length!==2)throw new Error("Invalid DOM (participants)");n.includes("top")&&populateParticipantSelect(e,"top",o[0],i,a,s.winner,t),n.includes("bottom")&&populateParticipantSelect(e,"bottom",o[1],r,c,s.winner,t)}function renderMatchInfo(e,t){const n=e.matches[t],s=document.querySelector(`div.match[data-match-id="${t}"]`),o=s.querySelector("div.match-result");n.result===""?o.textContent="{Result}":o.textContent=n.result;const i=s.querySelector("div.bout-number");n.boutNumber===null?i.innerHTML="&nbsp;":i.textContent=`${n.boutNumber}`}function renderBracket(e){e.description===null?document.getElementById("description-input").value="{Division} {Weight} ({Year})":document.getElementById("description-input").value=e.description;for(let t=0;t<=23;t++)renderWrestlerInput(e,t);for(let t=1;t<=16;t++)renderMatchReadOnly(e,t,["top","bottom"]);for(let t=17;t<=24;t++)renderMatchReadOnly(e,t,["top"]);for(let t=37;t<=40;t++)renderMatchReadOnly(e,t,["top","bottom"]);renderMatchReadOnly(e,41,["top"]),renderMatchReadOnly(e,42,["bottom"]),renderMatchReadOnly(e,43,["top"]),renderMatchReadOnly(e,44,["bottom"]),renderMatchReadOnly(e,49,["top"]),renderMatchReadOnly(e,50,["bottom"]),renderMatchReadOnly(e,52,["top","bottom"]);for(let t=17;t<=24;t++)renderMatchSelect(e,t,["bottom"]);for(let t=33;t<=36;t++)renderMatchSelect(e,t,["top","bottom"]);renderMatchSelect(e,41,["bottom"]),renderMatchSelect(e,42,["top"]),renderMatchSelect(e,43,["bottom"]),renderMatchSelect(e,44,["top"]),renderMatchSelect(e,45,["top","bottom"]),renderMatchSelect(e,46,["top","bottom"]),renderMatchSelect(e,47,["top","bottom"]),renderMatchSelect(e,48,["top","bottom"]),renderMatchSelect(e,49,["bottom"]),renderMatchSelect(e,50,["top"]),renderMatchSelect(e,53,["top","bottom"]),renderMatchSelect(e,54,["top","bottom"]),renderMatchSelect(e,1001,["top"]),renderMatchSelect(e,1003,["top"]),renderMatchSelect(e,1005,["top"]);for(let t=1;t<=54;t++){if(25<=t&&t<=32)continue;if(t==51)continue;renderMatchInfo(e,t)}}function setWinner(e,t){if(t===null)e.winner=null;else if(e.top.choice===t)e.winner="top";else if(e.bottom.choice===t)e.winner="bottom";else throw new Error("Chosen winner must be top or bottom")}function replaceChoices(e,t,n){const s=e.filter(e=>!t.includes(e));return n!==null&&s.push(n),uniqueNumerical(s)}function updateNextMatchChoices(e,t,n,s){const o=WIN_MATCH_MAP[t];if(o===null)return;const a=e.matches[o.match],i=a[o.position];i.choices=replaceChoices(i.choices,n.choices,s)}function getLoserID(e,t){if(t===null)return null;if(e.top.choice===t)return e.bottom.choice;if(e.bottom.choice===t)return e.top.choice;throw new Error("Chosen winner must be top or bottom")}function setLoser(e,t,n,s){const a=LOSE_MATCH_MAP[t];if(a===null)return;const o=getLoserID(n,s),l=e.matches[a.match],r=l[a.position],d=r.choice;r.choice=o,r.choices=o===null?[]:[o];const c=WIN_MATCH_MAP[a.match],u=e.matches[c.match],i=u[c.position];i.choices=i.choices.filter(e=>e!=d),o!==null&&i.choices.push(o),i.choices=uniqueNumerical(i.choices)}function findLoser(e,t,n){if(n===null)return null;for(const o of t){const s=e.matches[o];if(s.winner==="top"&&s.top.choice===n)return s.bottom.choice;if(s.winner==="bottom"&&s.bottom.choice===n)return s.top.choice}return null}function handleFollowLeader(e,t,n){if(t<33||t>36)return;const o=[],i=[];t===33&&(o.push(1,2,3,4),i.push(17,18)),t===34&&(o.push(5,6,7,8),i.push(19,20)),t===35&&(o.push(9,10,11,12),i.push(21,22)),t===36&&(o.push(13,14,15,16),i.push(23,24));const v=t+4,a=e.matches[v],p=t%2===1?"top":"bottom",l=a[p],d=t%2===1?"bottom":"top",u=a[d],r=findLoser(e,o,n),c=findLoser(e,i,n);l.choice=r,u.choice=c;const m=t+8,g=e.matches[m],s=g[d],f=WIN_MATCH_MAP[m],b=e.matches[f.match],h=b[f.position];l.choices=[],u.choices=[],s.choices=[],r!==null&&(l.choices.push(r),s.choices.push(r)),c!==null&&(u.choices.push(c),s.choices.push(c)),s.choices=uniqueNumerical(s.choices),s.choice=null,a.winner=null,s.choices.length===1&&(s.choice=s.choices[0],a.winner=d,a.result="Bye",h.choices.push(s.choice),h.choices=uniqueNumerical(h.choices))}function handleSelectChange(e,t){const s=t.target,n=s.value===""?null:Number(s.value);validateParticipantID(n);const o=Number(s.dataset.matchId),a=s.dataset.position,l=e.matches[o],r=l[a];r.choice=n;const i=PREVIOUS_MATCH_MAP[o][a],c=e.matches[i];setWinner(c,n),updateNextMatchChoices(e,o,r,n),setLoser(e,i,c,n),handleFollowLeader(e,i,n)}function handleHeaderInputChange(e,t){const n=t.target;if(n.id==="description-input"){e.description=n.value;return}throw new Error("Invalid input element")}function handleParticipantInputChange(e,t){const n=t.target,s=Number(n.dataset.participantId);validateParticipantID(s);const o=e.wrestlerChoices[s];if(n.className==="input-name")o.name=n.value;else if(n.className==="input-team")o.team=n.value;else throw new Error("Invalid input element")}function getMatchInfoDiv(e){const t=`.match[data-match-id="${e}"] .match-info`;return document.querySelector(t)}function openMatchOverlayEventListener(e){if(e.key==="Enter"&&(e.preventDefault(),saveMatchOverlay()),e.key==="Tab"){e.preventDefault(),saveMatchOverlay();const s=e.currentTarget,o=Number(s.dataset.matchId),t=OVERLAY_NEXT_MATCH[o];if(t===0[0])return;const n=getMatchInfoDiv(t);if(n===null)return;openMatchOverlay(n)}}function openMatchOverlay(e){const t=document.getElementById("edit-match-result"),o=e.parentElement.parentElement,n=Number(o.dataset.matchId);t.dataset.matchId=n,LISTENER_REGISTERED.openMatchOverlay||(t.addEventListener("keydown",openMatchOverlayEventListener),LISTENER_REGISTERED.openMatchOverlay=!0);const s=BRACKET_INFO.matches[n];EDIT_MATCH_INFO_CURRENT.matchID=n,s.boutNumber===null?document.getElementById("edit-bout-number").value="":document.getElementById("edit-bout-number").value=`${s.boutNumber}`,t.value=s.result,document.getElementById("edit-match-info-overlay").classList.remove("hidden")}function propagateBoutNumberEdit(e,t){if(e===2){BRACKET_INFO.matches[4].boutNumber=t+1,BRACKET_INFO.matches[6].boutNumber=t+4,BRACKET_INFO.matches[8].boutNumber=t+5,BRACKET_INFO.matches[10].boutNumber=t+8,BRACKET_INFO.matches[12].boutNumber=t+9,BRACKET_INFO.matches[14].boutNumber=t+12,BRACKET_INFO.matches[16].boutNumber=t+13;return}const n=t-e;for(const o of RELATED_MATCH_IDS){const[t,s]=o;if(t<=e&&e<=s){for(let e=t;e<=s;e++){const o=BRACKET_INFO.matches[e],i=n+e;o.boutNumber=i}return}}}function saveMatchOverlay(){const t=EDIT_MATCH_INFO_CURRENT.matchID,e=BRACKET_INFO.matches[t],n=document.getElementById("edit-bout-number").value;n===""?e.boutNumber=null:(e.boutNumber=Number(n),propagateBoutNumberEdit(t,e.boutNumber));const s=document.getElementById("edit-match-result").value;e.result=s,writeToStorage(BRACKET_INFO),closeMatchOverlay()}function closeMatchOverlay(){document.getElementById("edit-match-info-overlay").classList.add("hidden"),renderBracket(BRACKET_INFO),EDIT_MATCH_INFO_CURRENT.matchID=1}function clearJSON(e){e.description=INITIAL_BRACKET_INFO.description,e.wrestlerChoices=INITIAL_BRACKET_INFO.wrestlerChoices,e.matches=INITIAL_BRACKET_INFO.matches,writeToStorage(e),renderBracket(e)}document.querySelectorAll("select.participant-select").forEach(e=>{e.addEventListener("change",e=>{handleSelectChange(BRACKET_INFO,e),writeToStorage(BRACKET_INFO),renderBracket(BRACKET_INFO)})}),document.querySelectorAll(".header-input").forEach(e=>{e.addEventListener("input",e=>{handleHeaderInputChange(BRACKET_INFO,e),writeToStorage(BRACKET_INFO),renderBracket(BRACKET_INFO)})}),document.querySelectorAll("input.input-name, input.input-team").forEach(e=>{e.addEventListener("input",e=>{handleParticipantInputChange(BRACKET_INFO,e),writeToStorage(BRACKET_INFO),renderBracket(BRACKET_INFO)})}),document.getElementById("download-json").addEventListener("click",function(e){e.preventDefault();const s=JSON.stringify(BRACKET_INFO,null,2)+`
`,o=new Blob([s],{type:"application/json"}),n=URL.createObjectURL(o),t=document.createElement("a");t.href=n,t.download="bracket.json",t.click(),URL.revokeObjectURL(n)}),document.getElementById("clear-json").addEventListener("click",function(e){e.preventDefault(),clearJSON(BRACKET_INFO)});const BRACKET_INFO=JSON.parse(JSON.stringify(INITIAL_BRACKET_INFO));loadFromStorage(BRACKET_INFO),renderBracket(BRACKET_INFO)